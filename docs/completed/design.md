# ランダム登壇順決定アプリ 設計書

## 目的

登壇者の名前を登録し、順番をランダムに決定して1人ずつ順番に表示する。全順序は最初に見せず、「一人目」ボタンから段階的に公開する。SvelteKit + pnpm で実装する。

## ユースケースとフロー

- 初期: テキスト入力と「追加」ボタンで登壇者名を登録。Enter でも追加。登録済みリストを表示し、個別削除が可能。
- シャッフル: 登録が2名以上で「ランダムに並べる」ボタンが有効。押下で順序を決定するが表示はしない。
- 表示: 「一人目」→「二人目」…ボタンで1人ずつ中央に大きく表示。完了後は「リセット/もう一度」ボタンを提示。
- リセット: 登壇者リストも含めて全消去し、初期状態に戻す。
- 防御: シャッフル後はリセットするまで再シャッフル不可（意図しない並び替え防止）。

## 状態モデル

- `participants: string[]` 登録済みの名前
- `order: string[]` シャッフル結果（未生成時は空）
- `revealedIndex: number` 表示済みの末尾インデックス（初期値 -1）
- 派生状態
  - `isReadyToShuffle = participants.length >= 2`
  - `hasOrder = order.length > 0`
  - `isFinished = hasOrder && revealedIndex >= order.length - 1`

## 主要ロジック

- 追加: 入力を trim。空文字は拒否。重複名は拒否。通過したら `participants` に push。
- シャッフル: Fisher–Yates で `participants` のコピーをシャッフルし `order` に格納。`revealedIndex = -1` に戻す。
- 表示: `revealedIndex < order.length - 1` のときのみ `revealedIndex++`。ガードで範囲外防止。
- リセット: `participants`, `order`, `revealedIndex` を初期化。

## UI/UX

- 単一ページ（`+page.svelte`）内で完結。
- 登壇者リスト: タグ/ピル表示 + 削除ボタン。人数をカウント表示。
- シャッフルボタン: `isReadyToShuffle` で有効化。シャッフル後は非表示または無効化。
- 表示ボタン: シャッフル後に表示。ラベルは「一人目」「二人目」…（インデックス基準）。完了時は無効化。
- 名前表示領域: 画面中央、大きめのテキスト。`fade`/`scale` で登場アニメーション。
- 完了表示: 「全員表示しました」「リセット/もう一度」ボタン。
- アクセシビリティ: 入力に `aria-label`、ボタンに `aria-disabled`。フォーカスリングを残す。

## ファイル構成案

- `src/routes/+page.svelte`: ページ本体、状態管理、UI、スタイル。
- `src/lib/shuffle.ts`: `shuffle<T>(arr: T[]): T[]`（純粋関数、テスト容易）。

## 永続化

- 必須ではないが、`participants` を `localStorage` へ保存/復元すると便利。`order` はスポイラー防止で保存しない。

## バリデーションとエッジケース

- 空/空白のみは追加不可。
- 重複名は追加拒否（要件準拠）。
- シャッフル前に表示ボタンを押せないようガード。
- 表示途中にリセットした場合は初期状態へ戻る。

## テスト方針

- 単体: `shuffle` が
  - 元配列を破壊しない（参照が変わる）
  - 長さを保持し、要素集合が同じ
- 手動: 登録/削除の動作、2名未満でシャッフル無効、シャッフル後の順序と表示ボタンの進行一致、全員表示後のリセット。

## 実装メモ

- `+page.svelte` で `fade`/`scale` を利用。
- ボタンの有効/無効は状態に基づいて明示的に制御。
- 文言はすべて日本語で統一。
